
{% block title %}Candidate Profile{% endblock %}
{% block content %}

<link rel="stylesheet" href="/static/css/candidate_profile.css">

<style>
  /* Clean white theme styling */
  * {
    box-sizing: border-box;
  }
  
  .main-container {
    max-width: 100%;
    width: 100%;
    margin: 0;
    padding: 20px;
    background: #ffffff;
    min-height: 100vh;
    box-sizing: border-box;
  }
  
  .profile-header {
    background: #ffffff;
    color: #2d3748;
    padding: 30px;
    border-radius: 8px;
    margin-bottom: 30px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e2e8f0;
  }
  
  .profile-header h1 {
    margin: 0 0 15px 0;
    font-size: 2.2rem;
    font-weight: 700;
    color: #1a202c;
  }
  
  .profile-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  
  .meta-item {
    background: #f7fafc;
    padding: 12px 16px;
    border-radius: 6px;
    border: 1px solid #e2e8f0;
  }
  
  .meta-label {
    font-size: 0.8rem;
    color: #718096;
    font-weight: 500;
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .meta-value {
    font-size: 1rem;
    font-weight: 600;
    color: #2d3748;
  }
  
  .status-badge {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 15px;
    font-weight: 600;
    font-size: 0.85rem;
    border: 1px solid;
  }
  
  .content-grid {
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 30px;
    margin-bottom: 30px;
  }
  
  .card {
    background: #ffffff;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e2e8f0;
    margin-bottom: 20px;
  }
  
  .card-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2d3748;
    margin: 0 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid #e2e8f0;
  }
  
  .progress-timeline {
    position: relative;
    padding: 20px 0;
  }
  
  .timeline-step {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    position: relative;
  }
  
  .step-icon {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    margin-right: 15px;
    border: 2px solid;
  }
  
  .step-content {
    flex: 1;
  }
  
  .step-title {
    font-weight: 600;
    margin-bottom: 4px;
    font-size: 0.95rem;
  }
  
  .step-subtitle {
    font-size: 0.8rem;
    color: #718096;
  }
  
  .timeline-connector {
    position: absolute;
    left: 17px;
    top: 35px;
    width: 2px;
    height: calc(100% - 35px);
    background: #e2e8f0;
  }
  
  .action-panel {
    position: sticky;
    top: 20px;
  }
  
  .action-card {
    background: #ffffff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e2e8f0;
    margin-bottom: 15px;
  }
  
  .btn {
    display: inline-block;
    padding: 10px 20px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
    text-align: center;
    transition: all 0.2s;
    width: 100%;
    margin-bottom: 8px;
    background: #ffffff;
    color: #2d3748;
  }
  
  .btn-primary {
    background: #4299e1;
    border-color: #4299e1;
    color: #ffffff;
  }
  
  .btn-success {
    background: #48bb78;
    border-color: #48bb78;
    color: #ffffff;
  }
  
  .btn-warning {
    background: #ed8936;
    border-color: #ed8936;
    color: #ffffff;
  }
  
  .btn-danger {
    background: #f56565;
    border-color: #f56565;
    color: #ffffff;
  }
  
  .btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }
  
  .form-group {
    margin-bottom: 15px;
  }
  
  .form-label {
    display: block;
    font-weight: 500;
    color: #2d3748;
    margin-bottom: 6px;
    font-size: 0.9rem;
  }
  
  .form-control {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: border-color 0.2s;
  }
  
  .form-control:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
  }
  
  .details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  
  .detail-item {
    padding: 15px;
    background: #f7fafc;
    border-radius: 6px;
    border: 1px solid #e2e8f0;
  }
  
  .detail-label {
    font-size: 0.75rem;
    color: #718096;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
    font-weight: 500;
  }
  
  .detail-value {
    font-weight: 600;
    color: #2d3748;
  }
  
  .alert {
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
    border: 1px solid;
    background: #f7fafc;
  }
  
  .alert-info {
    border-color: #bee3f8;
    color: #2c5282;
  }
  
  .alert-success {
    border-color: #c6f6d5;
    color: #276749;
  }
  
  .alert-warning {
    border-color: #fbd38d;
    color: #744210;
  }
  
  .alert-danger {
    border-color: #feb2b2;
    color: #742a2a;
  }
  
  /* Horizontal Timeline Flow Styles */
  .timeline-flow {
    position: relative;
    padding: 40px 20px;
    background: #f8fafc;
    border-radius: 12px;
    margin: 20px 0;
    overflow-x: auto;
  }
  
  .timeline-container {
    display: flex;
    align-items: flex-start;
    min-width: 1000px;
    position: relative;
    padding: 20px 0;
  }
  
  .timeline-container::before {
    content: '';
    position: absolute;
    top: 60px;
    left: 60px;
    right: 60px;
    height: 4px;
    background: #e2e8f0;
    border-radius: 2px;
  }
  
  /* Dynamic timeline progress line based on status and steps visible */
  .timeline-container.status-shortlisted::before {
    background: linear-gradient(to right, #10b981 0%, #10b981 20%, #e2e8f0 20%, #e2e8f0 100%);
  }
  
  .timeline-container.status-interview-scheduled::before,
  .timeline-container.status-interviewed::before {
    background: linear-gradient(to right, #10b981 0%, #10b981 40%, #e2e8f0 40%, #e2e8f0 100%);
  }
  
  .timeline-container.status-pending-approval::before {
    background: linear-gradient(to right, #10b981 0%, #10b981 60%, #e2e8f0 60%, #e2e8f0 100%);
  }
  
  .timeline-container.status-approved::before,
  .timeline-container.status-selected::before {
    background: linear-gradient(to right, #10b981 0%, #10b981 80%, #e2e8f0 80%, #e2e8f0 100%);
  }
  
  .timeline-container.status-hired::before {
    background: linear-gradient(to right, #10b981 0%, #10b981 100%);
  }
  
  .timeline-container.status-onboarding::before {
    background: linear-gradient(to right, #10b981 0%, #10b981 100%);
  }
  
  /* Connection line from timeline step to dropdown */
  .timeline-step.active::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    width: 3px;
    height: 30px;
    background: #10b981;
    border-radius: 0 0 3px 3px;
    z-index: 10;
  }
  
  .timeline-step {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 180px;
    margin: 0 5px;
    z-index: 1;
  }
  
  .timeline-step.completed .step-icon {
    background: #10b981;
    color: white;
    border-color: #10b981;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }
  
  .timeline-step.completed .step-title {
    color: #10b981;
    font-weight: 600;
  }
  
  .timeline-step.in-progress .step-icon {
    background: #f59e0b;
    color: white;
    border-color: #f59e0b;
    animation: pulse 2s infinite;
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
  }
  
  .timeline-step.pending-response {
    background: transparent;
    border-color: transparent;
  }
  
  .timeline-step.pending-response .step-icon {
    background: #ef4444;
    color: white;
    border-color: #ef4444;
    animation: pulse 2s infinite;
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
  }
  
  .timeline-step.pending-response .step-title {
    color: #ef4444;
    font-weight: 600;
  }
  
  .timeline-step.pending-response .step-subtitle {
    color: #ef4444;
  }
  
  .step-date.pending-response {
    color: #ef4444;
    font-weight: 600;
    background: #fef2f2;
    border-color: #fca5a5;
  }
  
  .timeline-step.in-progress .step-title {
    color: #f59e0b;
    font-weight: 600;
  }
  
  .timeline-step.awaiting-confirmation .step-icon {
    background: #ef4444;
    color: white;
    border-color: #ef4444;
    animation: blink 1s infinite;
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
  }
  
  .timeline-step.awaiting-confirmation .step-title {
    color: #ef4444;
    font-weight: 600;
  }
  
  .timeline-step.pending .step-icon {
    background: #f3f4f6;
    color: #6b7280;
    border-color: #d1d5db;
  }
  
  .timeline-step.pending .step-title {
    color: #6b7280;
  }
  
  .step-icon {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
    border: 4px solid;
    background: white;
    z-index: 2;
    position: relative;
    margin-bottom: 15px;
    transition: all 0.3s ease;
  }
  
  .step-content {
    text-align: center;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .step-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
  }
  
  .step-subtitle {
    font-size: 0.8rem;
    color: #6b7280;
    line-height: 1.4;
    margin-bottom: 8px;
    text-align: center;
  }
  
  .step-date {
    font-size: 0.75rem;
    color: #9ca3af;
    font-weight: 500;
    background: #f3f4f6;
    padding: 4px 8px;
    border-radius: 12px;
    margin-top: 4px;
  }
  
  .step-date.completed {
    background: #ecfdf5;
    color: #065f46;
  }
  
  .step-date.in-progress {
    background: #fffbeb;
    color: #92400e;
  }
  
  .expand-icon {
    font-size: 0.7rem;
    transition: transform 0.3s ease;
    color: inherit;
  }
  
  .timeline-step.expanded .expand-icon {
    transform: rotate(180deg);
  }
  
  .timeline-step:hover .step-icon {
    transform: scale(1.1);
  }
  
  .collapsible-content {
    display: none;
    width: 100%;
    max-height: 0;
    overflow: hidden;
    transition: all 0.4s ease;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(16, 185, 129, 0.15);
    border: 2px solid #10b981;
    margin-bottom: 20px;
    position: relative;
    z-index: auto;
  }
  
  .collapsible-content::before {
    content: '';
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-bottom: 12px solid #10b981;
  }
  
  .collapsible-content.active {
    display: block;
    max-height: 800px;
    overflow-y: auto;
    padding: 20px;
    animation: slideDown 0.3s ease-out;
  }
  
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .timeline-details-container {
    margin-top: 30px;
    width: 100%;
    position: static;
    clear: both;
  }
  
  .step-details {
    width: 100%;
  }
  
  .step-details .card {
    margin-bottom: 0;
    box-shadow: none;
    border: none;
    background: #f8fafc;
    padding: 15px;
    border-radius: 8px;
  }
  
  .step-details .card-title {
    font-size: 1.1rem;
    color: #2d3748;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  /* Approval Flow Specific Styles */
  .approval-flow-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    margin-bottom: 10px;
    background: #ffffff;
    transition: all 0.2s ease;
  }
  
  .approval-flow-item:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .approval-flow-item.final-approval {
    border-color: #48bb78;
    background: #f0fff4;
  }
  
  .approval-icon {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: #48bb78;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: bold;
    flex-shrink: 0;
  }
  
  .approval-content {
    flex: 1;
  }
  
  .approval-role {
    font-weight: 600;
    color: #2d3748;
    font-size: 0.95rem;
    margin-bottom: 2px;
  }
  
  .approval-user {
    color: #718096;
    font-size: 0.85rem;
    margin-bottom: 3px;
  }
  
  .approval-date {
    color: #a0aec0;
    font-size: 0.75rem;
    margin-bottom: 6px;
  }
  
  .approval-comment {
    color: #4a5568;
    font-size: 0.85rem;
    background: #f7fafc;
    padding: 8px 10px;
    border-radius: 6px;
    border-left: 3px solid #3b82f6;
    margin-top: 4px;
  }
  
  /* Offer Status Styles */
  .offer-status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .offer-item {
    text-align: center;
    padding: 10px;
    background: #f8fafc;
    border-radius: 6px;
    border: 1px solid #e2e8f0;
  }
  
  .offer-label {
    font-size: 0.75rem;
    color: #718096;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
    font-weight: 500;
  }
  
  .offer-value {
    font-weight: 600;
    color: #2d3748;
    font-size: 0.9rem;
  }
  
  .status-badge {
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 500;
    display: inline-block;
  }
  
  .status-badge.success {
    background: #f0fff4;
    color: #22543d;
    border: 1px solid #c6f6d5;
  }
  
  .status-badge.warning {
    background: #fffbeb;
    color: #744210;
    border: 1px solid #fbd38d;
  }
  
  .status-badge.pending {
    background: #f7fafc;
    color: #4a5568;
    border: 1px solid #e2e8f0;
  }
  
  /* New Approval Flow Styles */
  .approval-flow-container {
    margin: 20px 0;
    padding: 20px;
    background: #f9fafb;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
  }
  
  .flow-steps {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .approval-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    border-radius: 10px;
    min-width: 140px;
    transition: all 0.3s ease;
    position: relative;
  }
  
  .approval-step.completed {
    background: #dcfce7;
    border: 2px solid #22c55e;
  }
  
  .approval-step.current {
    background: #fef3c7;
    border: 2px solid #f59e0b;
    animation: pulse 2s infinite;
  }
  
  .approval-step.pending {
    background: #f3f4f6;
    border: 2px solid #d1d5db;
  }
  
  .approval-step .step-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 1.1rem;
  }
  
  .approval-step.completed .step-icon {
    background: #22c55e;
    color: white;
  }
  
  .approval-step.current .step-icon {
    background: #f59e0b;
    color: white;
  }
  
  .approval-step.pending .step-icon {
    background: #9ca3af;
    color: white;
  }
  
  .approval-step .step-content {
    text-align: center;
  }
  
  .approval-step .step-role {
    font-weight: 600;
    color: #374151;
    font-size: 0.9rem;
    margin-bottom: 4px;
  }
  
  .approval-step .step-action {
    font-size: 0.75rem;
    color: #6b7280;
    margin-bottom: 6px;
  }
  
  .approval-step .step-status {
    font-size: 0.7rem;
    font-weight: 500;
    padding: 2px 6px;
    border-radius: 10px;
  }
  
  .status-completed {
    background: #dcfce7;
    color: #166534;
  }
  
  .status-current {
    background: #fef3c7;
    color: #92400e;
  }
  
  .status-pending {
    background: #f3f4f6;
    color: #6b7280;
  }
  
  .step-arrow {
    color: #9ca3af;
    font-size: 1.5rem;
    font-weight: bold;
  }
  
  .approval-history-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    margin-bottom: 10px;
    background: #ffffff;
    transition: all 0.2s ease;
  }
  
  .approval-history-item:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .approval-history-item.final-approval {
    border-color: #3b82f6;
    background: #eff6ff;
  }
  
  @keyframes pulse {
    0%, 100% { 
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4);
    }
    50% { 
      transform: scale(1.02);
      box-shadow: 0 0 0 10px rgba(245, 158, 11, 0);
    }
  }
    margin-bottom: 15px;
    color: #1f2937;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 8px;
  }
  
  .approval-flow-item {
    display: flex;
    align-items: center;
    padding: 12px;
    margin-bottom: 10px;
    background: #f8fafc;
    border-radius: 8px;
    border-left: 4px solid #10b981;
  }
  
  .approval-flow-item.final-approval {
    border-left-color: #3b82f6;
    background: #eff6ff;
  }
  
  .approval-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #10b981;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-weight: 600;
    font-size: 0.9rem;
  }
  
  .approval-content {
    flex: 1;
  }
  
  .approval-role {
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 2px;
    font-size: 0.9rem;
  }
  
  .approval-user {
    font-size: 0.8rem;
    color: #4a5568;
    margin-bottom: 2px;
  }
  
  .approval-date {
    font-size: 0.75rem;
    color: #718096;
    margin-bottom: 5px;
  }
  
  .approval-comment {
    font-size: 0.8rem;
    color: #2d3748;
    font-style: italic;
    background: #f7fafc;
    padding: 6px;
    border-radius: 4px;
    margin-top: 5px;
  }
  
  .offer-status-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 15px;
  }
  
  .offer-item {
    background: #f8fafc;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #e2e8f0;
  }
  
  .offer-label {
    font-size: 0.75rem;
    color: #718096;
    font-weight: 500;
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .offer-value {
    font-size: 0.9rem;
    font-weight: 600;
    color: #2d3748;
  }
  
  .status-badge.success {
    background: #f0fff4;
    color: #22543d;
    border-color: #c6f6d5;
  }
  
  .status-badge.warning {
    background: #fffbeb;
    color: #744210;
    border-color: #fbd38d;
  }
  
  .status-badge.pending {
    background: #f7fafc;
    color: #4a5568;
    border-color: #cbd5e0;
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    .timeline-container {
      min-width: 800px;
    }
    
    .timeline-step {
      min-width: 140px;
      margin: 0 5px;
    }
    
    .collapsible-content {
      width: 320px;
    }
    
    .step-title {
      font-size: 0.9rem;
    }
    
    .step-subtitle {
      font-size: 0.75rem;
    }
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
  }
  
  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0.6; }
  }
  
  @media (max-width: 1024px) {
    .content-grid {
      grid-template-columns: 1fr;
    }
    
    .action-panel {
      position: static;
    }
    
    .profile-meta {
      grid-template-columns: 1fr;
    }
  }
  
  .file-preview {
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    overflow: hidden;
    margin-top: 15px;
  }
  
  .collapsible {
    background: #f7fafc;
    padding: 15px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    margin-top: 15px;
  }
  
  .collapsible summary {
    font-weight: 600;
    cursor: pointer;
    color: #2d3748;
  }
  
  .collapsible[open] summary {
    margin-bottom: 15px;
  }
  
  .section-divider {
    width: 100%;
    height: 1px;
    background: #e2e8f0;
    margin: 30px 0;
  }
  
  /* Approval Flow Styles */
  .approval-flow {
    margin: 20px 0;
  }
  
  .approval-step {
    margin-bottom: 20px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 15px;
    background: #ffffff;
  }
  
  .step-header {
    display: flex;
    align-items: center;
    gap: 15px;
  }
  
  .step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #f7fafc;
    border: 2px solid #e2e8f0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: #2d3748;
  }
  
  .step-info {
    flex: 1;
  }
  
  .step-role {
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 4px;
  }
  
  .step-status {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
    display: inline-block;
  }
  
  .status-pending {
    background: #fef3c7;
    color: #92400e;
    border: 1px solid #fbbf24;
  }
  
  .status-approved {
    background: #dcfce7;
    color: #166534;
    border: 1px solid #22c55e;
  }
  
  .status-rejected {
    background: #fecaca;
    color: #991b1b;
    border: 1px solid #ef4444;
  }
  
  .step-details {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #f1f5f9;
    color: #64748b;
    font-size: 0.9rem;
  }
  
  .step-details p {
    margin: 4px 0;
  }
  
  /* Timeline Date Styling */
  .step-date {
    font-size: 0.7rem;
    font-weight: 600;
    padding: 2px 6px;
    border-radius: 8px;
    margin-top: 4px;
    min-width: 80px;
    text-align: center;
    border: 1px solid transparent;
  }
  
  .step-date.completed {
    background: #dcfce7;
    color: #166534;
    border-color: #bbf7d0;
  }
  
  .step-date.in-progress {
    background: #fff7ed;
    color: #c2410c;
    border-color: #fed7aa;
    animation: pulse 2s infinite;
  }
  
  .step-date:not(.completed):not(.in-progress) {
    background: #f3f4f6;
    color: #6b7280;
    border-color: #e5e7eb;
  }

  /* Expand Icon Animation */
  .expand-icon {
    transition: transform 0.2s ease;
    display: inline-block;
    margin-left: 5px;
    font-size: 0.8rem;
  }
  
  .collapsible-trigger:hover .expand-icon {
    transform: scale(1.1);
  }

  /* Timeline Responsive Design */
  @media (max-width: 1024px) {
    .timeline-container {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .timeline-container::before {
      width: 2px;
      height: 100%;
      left: 15px;
      top: 0;
    }
    
    .timeline-step {
      width: 100%;
      padding: 10px 0 10px 40px;
      position: relative;
    }
    
    .step-icon {
      position: absolute;
      left: -40px;
    }
  }

  @media (max-width: 768px) {
    .timeline-step {
      padding: 8px 0 8px 35px;
    }
    
    .timeline-container::before {
      left: 12px;
    }
    
    .step-icon {
      left: -35px;
      width: 24px;
      height: 24px;
      font-size: 0.7rem;
    }
    
    .step-content {
      font-size: 0.9rem;
    }
    
    .step-date {
      font-size: 0.65rem;
      min-width: 70px;
    }
  }
  
  /* Additional layout fixes */
  body {
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }
  
  .container {
    width: 100%;
    max-width: none;
    margin: 0;
    padding: 0;
  }
  
  /* Timeline positioning fixes */
  .timeline-details-container {
    position: static;
    width: 100%;
    margin-top: 20px;
    padding: 0 20px;
    box-sizing: border-box;
  }
  
  .collapsible-content {
    position: static;
    width: 100%;
    margin-top: 15px;
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: none;
    box-sizing: border-box;
  }
  
  .collapsible-content.active {
    display: block;
  }
</style>

<div class="main-container">
  <!-- Profile Header -->
  <div class="profile-header">
    <h1>{{ candidate.name }}</h1>
    <div class="profile-meta">
      <div class="meta-item">
        <div class="meta-label">Email</div>
        <div class="meta-value">{{ candidate.email }}</div>
      </div>
      <div class="meta-item">
        <div class="meta-label">Phone</div>
        <div class="meta-value">{{ candidate.phone }}</div>
      </div>
      <div class="meta-item">
        <div class="meta-label">Position</div>
        <div class="meta-value">{{ candidate.position }}</div>
      </div>
      <div class="meta-item">
        <div class="meta-label">Applied Date</div>
        <div class="meta-value">{{ candidate.applied_date }}</div>
      </div>
      <div class="meta-item">
        <div class="meta-label">Status</div>
        <div class="meta-value">
          <span class="status-badge" style="
            {% if candidate.status == 'New' %}background: #e3f2fd; color: #1565c0;
            {% elif candidate.status == 'Shortlisted' %}background: #fff3e0; color: #ef6c00;
            {% elif candidate.status == 'Interview Scheduled' %}background: #f3e5f5; color: #7b1fa2;
            {% elif candidate.status == 'Interviewed' %}background: #e8f5e9; color: #2e7d32;
            {% elif candidate.status == 'Pending Approval' %}background: #fff3cd; color: #856404;
            {% elif candidate.status == 'Approved' %}background: #d4edda; color: #155724;
            {% elif candidate.status == 'Selected' %}background: #cce5ff; color: #004d99;
            {% elif candidate.status == 'Hired' %}background: #d1ecf1; color: #0c5460;
            {% elif candidate.status == 'Rejected' %}background: #f8d7da; color: #721c24;
            {% elif candidate.status == 'On Hold' %}background: #ffeaa7; color: #6c5ce7;
            {% else %}background: #f8f9fa; color: #495057;{% endif %}">
            {{ candidate.status }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Grid -->
  <div class="content-grid">
    <!-- Main Content -->
    <div class="main-content">

      <!-- Application Progress Timeline -->
      <div class="card">
        <h2 class="card-title">📈 Application Progress Timeline</h2>
        <div class="timeline-flow">
          <div class="timeline-container status-{{ candidate.status.lower().replace(' ', '-') }}{% if candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %} has-pending{% endif %}">
            
            <!-- Step 1: Application Submitted -->
            <div class="timeline-step completed">
              <div class="step-icon">✓</div>
              <div class="step-content">
                <div class="step-title">Application Submitted</div>
                <div class="step-subtitle">{{ candidate.name }} applied</div>
                <div class="step-date completed">{{ candidate.applied_date or '2025-01-01' }}</div>
              </div>
            </div>
            
            <!-- Step 2: Shortlisted -->
            <div class="timeline-step {% if candidate.status in ['Shortlisted', 'Interview Scheduled', 'Interviewed', 'Pending Approval', 'Approved', 'Selected', 'Hired', 'Onboarding'] %}completed{% else %}pending{% endif %} collapsible-trigger" 
                 data-target="shortlisted-details">
              <div class="step-icon">
                {% if candidate.status in ['Shortlisted', 'Interview Scheduled', 'Interviewed', 'Pending Approval', 'Approved', 'Selected', 'Hired', 'Onboarding'] %}✓{% else %}2{% endif %}
              </div>
              <div class="step-content">
                <div class="step-title">Shortlisted <span class="expand-icon">▼</span></div>
                <div class="step-subtitle">Resume reviewed</div>
                <div class="step-date {% if candidate.status in ['Shortlisted', 'Interview Scheduled', 'Interviewed', 'Pending Approval', 'Approved', 'Selected', 'Hired', 'Onboarding'] %}completed{% endif %}">
                  {{ candidate.shortlisted_date or '2025-01-02' }}
                </div>
              </div>
            </div>
            
            <!-- Step 3: Interview Process -->
            <div class="timeline-step {% if candidate.status in ['Interview Scheduled'] %}in-progress{% elif candidate.status in ['Interviewed', 'Pending Approval', 'Approved', 'Selected', 'Hired', 'Onboarding'] %}completed{% else %}pending{% endif %} collapsible-trigger" 
                 data-target="interview-details">
              <div class="step-icon">
                {% if candidate.status in ['Interviewed', 'Pending Approval', 'Approved', 'Selected', 'Hired', 'Onboarding'] %}✓
                {% elif candidate.status == 'Interview Scheduled' %}⏳
                {% else %}3{% endif %}
              </div>
              <div class="step-content">
                <div class="step-title">Interview <span class="expand-icon">▼</span></div>
                <div class="step-subtitle">
                  {% if candidate.status == 'Interview Scheduled' %}Scheduled
                  {% elif candidate.status in ['Interviewed', 'Pending Approval', 'Approved', 'Selected', 'Hired', 'Onboarding'] %}Completed
                  {% else %}Pending{% endif %}
                </div>
                <div class="step-date {% if candidate.status == 'Interview Scheduled' %}in-progress{% elif candidate.status in ['Interviewed', 'Pending Approval', 'Approved', 'Selected', 'Hired', 'Onboarding'] %}completed{% endif %}">
                  {{ candidate.interview_date or '2025-01-03' }}
                </div>
              </div>
            </div>
            
            <!-- Step 4: Management Approval -->
            <div class="timeline-step {% if candidate.status == 'Pending Approval' %}in-progress{% elif candidate.status in ['Approved', 'Selected', 'Hired', 'Onboarding'] %}completed{% else %}pending{% endif %} collapsible-trigger" 
                 data-target="approval-details">
              <div class="step-icon">
                {% if candidate.status in ['Approved', 'Selected', 'Hired', 'Onboarding'] %}✓
                {% elif candidate.status == 'Pending Approval' %}⏳
                {% else %}4{% endif %}
              </div>
              <div class="step-content">
                <div class="step-title">Approval <span class="expand-icon">▼</span></div>
                <div class="step-subtitle">
                  {% if candidate.status == 'Pending Approval' %}In Review
                  {% elif candidate.status in ['Approved', 'Selected', 'Hired', 'Onboarding'] %}Approved
                  {% else %}Pending{% endif %}
                </div>
                <div class="step-date {% if candidate.status == 'Pending Approval' %}in-progress{% elif candidate.status in ['Approved', 'Selected', 'Hired', 'Onboarding'] %}completed{% endif %}">
                  {{ candidate.approved_date or '2025-01-04' }}
                </div>
              </div>
            </div>
            
            <!-- Step 5: Hired -->
            <div class="timeline-step {% if candidate.status == 'Hired' and candidate.contract_signed %}completed{% elif candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %}pending-response{% elif candidate.status == 'Hired' %}in-progress{% elif candidate.status == 'Selected' %}in-progress{% else %}pending{% endif %} collapsible-trigger" 
                 data-target="hired-details">
              <div class="step-icon">
                {% if candidate.status == 'Hired' and candidate.contract_signed %}✓
                {% elif candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %}⏳
                {% elif candidate.status == 'Hired' %}📋
                {% elif candidate.status == 'Selected' %}📋
                {% else %}5{% endif %}
              </div>
              <div class="step-content">
                <div class="step-title">
                  {% if candidate.status == 'Hired' %}Hired
                  {% elif candidate.status == 'Selected' %}Offer Letter
                  {% else %}Final Hiring{% endif %}
                  <span class="expand-icon">▼</span>
                </div>
                <div class="step-subtitle">
                  {% if candidate.status == 'Hired' and candidate.contract_signed %}Joined
                  {% elif candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %}Pending Response
                  {% elif candidate.status == 'Hired' %}Offer Accepted
                  {% elif candidate.status == 'Selected' %}Offer Stage
                  {% else %}Pending{% endif %}
                </div>
                <div class="step-date {% if candidate.status == 'Hired' and candidate.contract_signed %}completed{% elif candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %}pending-response{% elif candidate.status == 'Hired' %}in-progress{% elif candidate.status == 'Selected' %}in-progress{% endif %}">
                  {{ candidate.hired_date or '2025-01-05' }}
                </div>
              </div>
            </div>
            
            <!-- Step 6: Onboarding -->
            {% if candidate.status in ['Hired', 'Onboarding'] %}
            <div class="timeline-step {% if candidate.status == 'Onboarding' %}in-progress{% elif candidate.status == 'Hired' and candidate.contract_signed %}completed{% elif candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %}pending{% elif candidate.status == 'Hired' %}in-progress{% else %}pending{% endif %} collapsible-trigger" 
                 data-target="onboarding-details">
              <div class="step-icon">
                {% if candidate.status == 'Onboarding' %}⏳
                {% elif candidate.status == 'Hired' and candidate.contract_signed %}🚀
                {% elif candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %}⭕
                {% elif candidate.status == 'Hired' %}📋
                {% else %}6{% endif %}
              </div>
              <div class="step-content">
                <div class="step-title">Onboarding <span class="expand-icon">▼</span></div>
                <div class="step-subtitle">
                  {% if candidate.status == 'Onboarding' %}In Progress
                  {% elif candidate.status == 'Hired' and candidate.contract_signed %}Ready to Start
                  {% elif candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %}Awaiting Hiring Completion
                  {% elif candidate.status == 'Hired' %}Preparing
                  {% else %}Employee process{% endif %}
                </div>
                <div class="step-date {% if candidate.status == 'Onboarding' %}in-progress{% elif candidate.status == 'Hired' and candidate.contract_signed %}completed{% elif candidate.status == 'Hired' and not candidate.contract_signed and not candidate.offer_accepted %}pending{% elif candidate.status == 'Hired' %}in-progress{% endif %}">
                  {{ candidate.onboarding_date or '2025-01-06' }}
                </div>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
        
        <!-- Collapsible Details positioned OUTSIDE timeline -->
        <div class="timeline-details-container">
          <!-- Collapsible Shortlisted Details -->
          <div id="shortlisted-details" class="collapsible-content">
            <div class="step-details">
              <div class="card">
                <h3 class="card-title">👤 Candidate Information</h3>
                <div class="details-grid">
                  <div class="detail-item">
                    <div class="detail-label">Match Score</div>
                    <div class="detail-value">{{ candidate.match_score if candidate.match_score is defined else 'N/A' }}%</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Applied Job ID</div>
                    <div class="detail-value">{{ candidate.job_id }}</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Skills</div>
                    <div class="detail-value">
                      {% if candidate.skills %}
                        {% for skill in candidate.skills[:3] %}{{ skill }}{% if not loop.last %}, {% endif %}{% endfor %}
                        {% if candidate.skills|length > 3 %}...{% endif %}
                      {% else %}N/A{% endif %}
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Experience</div>
                    <div class="detail-value">{{ candidate.experience[0] if candidate.experience else 'N/A' }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Collapsible Interview Details -->
          <div id="interview-details" class="collapsible-content">
            <div class="step-details">
              {% if candidate.interview_score or candidate.ai_interview_report or candidate.interview_transcript %}
              <div class="card">
                <h3 class="card-title">🎯 Interview Analysis</h3>
                
                {% if candidate.interview_score %}
                <div class="detail-item" style="margin-bottom: 15px;">
                  <div class="detail-label">Interview Score</div>
                  <div class="detail-value" style="font-size: 1.3rem; color: #10b981;">{{ candidate.interview_score }}</div>
                </div>
                {% endif %}
                
                {% if candidate.ai_interview_report %}
                <div style="margin-bottom: 15px;">
                  <h4 style="color: #374151; margin-bottom: 8px; font-size: 0.9rem;">AI Analysis Report</h4>
                  <div style="background: #f8fafc; padding: 12px; border-radius: 6px; border-left: 3px solid #3b82f6; max-height: 150px; overflow-y: auto; font-size: 0.8rem;">
                    {{ candidate.ai_interview_report | replace('*', '') | replace('#', '') | replace('\n', '<br>') | safe }}
                  </div>
                </div>
                {% endif %}
              </div>
              {% else %}
              <div class="card">
                <p style="text-align: center; color: #6b7280; font-size: 0.9rem;">Interview details will appear here once completed</p>
              </div>
              {% endif %}
            </div>
          </div>
          
          <!-- Collapsible Approval Flow Details -->
          <div id="approval-details" class="collapsible-content">
            <div class="step-details">
              <div class="card">
                <h3 class="card-title">🔄 Approval Cycle Flow</h3>
                
                <!-- Approval Flow Steps Visualization -->
                <div class="approval-flow-container">
                  <div class="flow-steps">
                    <!-- Step 1: HR -->
                    <div class="approval-step {% if candidate.status in ['Pending Approval', 'Approved', 'Selected', 'Hired'] %}completed{% else %}pending{% endif %}">
                      <div class="step-icon">
                        {% if candidate.status in ['Pending Approval', 'Approved', 'Selected', 'Hired'] %}✓{% else %}1{% endif %}
                      </div>
                      <div class="step-content">
                        <div class="step-role">HR</div>
                        <div class="step-action">Send for Approval</div>
                        <div class="step-status">
                          {% if candidate.status in ['Pending Approval', 'Approved', 'Selected', 'Hired'] %}
                            <span class="status-completed">Completed</span>
                          {% else %}
                            <span class="status-pending">Pending</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                    
                    <div class="step-arrow">→</div>
                    
                    <!-- Step 2: Discipline Manager -->
                    <div class="approval-step {% if candidate.status == 'Pending Approval' and candidate.current_approval_step == 'Discipline Manager' %}current{% elif candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'equalto', 'Discipline Manager')|list|length > 0) %}completed{% else %}pending{% endif %}">
                      <div class="step-icon">
                        {% if candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'equalto', 'Discipline Manager')|list|length > 0) %}✓
                        {% elif candidate.status == 'Pending Approval' and candidate.current_approval_step == 'Discipline Manager' %}⏳
                        {% else %}2{% endif %}
                      </div>
                      <div class="step-content">
                        <div class="step-role">Discipline Manager</div>
                        <div class="step-action">Review & Approve</div>
                        <div class="step-status">
                          {% if candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'equalto', 'Discipline Manager')|list|length > 0) %}
                            <span class="status-completed">Approved</span>
                          {% elif candidate.status == 'Pending Approval' and candidate.current_approval_step == 'Discipline Manager' %}
                            <span class="status-current">In Review</span>
                          {% else %}
                            <span class="status-pending">Pending</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                    
                    <div class="step-arrow">→</div>
                    
                    <!-- Step 3: Department Manager -->
                    <div class="approval-step {% if candidate.status == 'Pending Approval' and candidate.current_approval_step in ['Department Manager (MOE)', 'Department Manager (MOP)'] %}current{% elif candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'in', ['Department Manager (MOE)', 'Department Manager (MOP)'])|list|length > 0) %}completed{% else %}pending{% endif %}">
                      <div class="step-icon">
                        {% if candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'in', ['Department Manager (MOE)', 'Department Manager (MOP)'])|list|length > 0) %}✓
                        {% elif candidate.status == 'Pending Approval' and candidate.current_approval_step in ['Department Manager (MOE)', 'Department Manager (MOP)'] %}⏳
                        {% else %}3{% endif %}
                      </div>
                      <div class="step-content">
                        <div class="step-role">Department Manager</div>
                        <div class="step-action">Review & Approve</div>
                        <div class="step-status">
                          {% if candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'in', ['Department Manager (MOE)', 'Department Manager (MOP)'])|list|length > 0) %}
                            <span class="status-completed">Approved</span>
                          {% elif candidate.status == 'Pending Approval' and candidate.current_approval_step in ['Department Manager (MOE)', 'Department Manager (MOP)'] %}
                            <span class="status-current">In Review</span>
                          {% else %}
                            <span class="status-pending">Pending</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                    
                    <div class="step-arrow">→</div>
                    
                    <!-- Step 4: Operation Manager -->
                    <div class="approval-step {% if candidate.status == 'Pending Approval' and candidate.current_approval_step == 'Operation Manager' %}current{% elif candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'equalto', 'Operation Manager')|list|length > 0) %}completed{% else %}pending{% endif %}">
                      <div class="step-icon">
                        {% if candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'equalto', 'Operation Manager')|list|length > 0) %}✓
                        {% elif candidate.status == 'Pending Approval' and candidate.current_approval_step == 'Operation Manager' %}⏳
                        {% else %}4{% endif %}
                      </div>
                      <div class="step-content">
                        <div class="step-role">Operation Manager</div>
                        <div class="step-action">Final Approval</div>
                        <div class="step-status">
                          {% if candidate.status in ['Approved', 'Selected', 'Hired'] or (candidate.approval_history and candidate.approval_history|selectattr('approved_by_role', 'equalto', 'Operation Manager')|list|length > 0) %}
                            <span class="status-completed">Approved</span>
                          {% elif candidate.status == 'Pending Approval' and candidate.current_approval_step == 'Operation Manager' %}
                            <span class="status-current">In Review</span>
                          {% else %}
                            <span class="status-pending">Pending</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Approval History Timeline -->
                {% if candidate.approval_history %}
                <div style="margin-top: 20px; border-top: 1px solid #e2e8f0; padding-top: 20px;">
                  <h4 style="color: #374151; margin-bottom: 15px; font-size: 0.9rem;">📋 Approval History</h4>
                  {% for step in candidate.approval_history %}
                  <div class="approval-history-item {% if step.is_final %}final-approval{% endif %}">
                    <div class="approval-icon">✓</div>
                    <div class="approval-content">
                      <div class="approval-role">{{ step.approved_by_role }}</div>
                      <div class="approval-user">{{ step.approved_by_user }}</div>
                      <div class="approval-date">{{ step.approved_at.split('T')[0] }}</div>
                      {% if step.comment %}
                      <div class="approval-comment">{{ step.comment }}</div>
                      {% endif %}
                    </div>
                  </div>
                  {% endfor %}
                </div>
                {% else %}
                <div style="margin-top: 20px; border-top: 1px solid #e2e8f0; padding-top: 20px;">
                  <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <p style="color: #6b7280; font-size: 0.9rem; margin: 0;">
                      📋 Approval history will appear here once the approval process begins
                    </p>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
          
          <!-- Collapsible Hired Details -->
          <div id="hired-details" class="collapsible-content">
            <div class="step-details">
              {% if candidate.status in ['Selected', 'Hired'] and candidate.offer_letter_details %}
              <div class="card">
                <h3 class="card-title">📧 Offer Letter & Contract</h3>
                <div class="offer-status-grid">
                  <div class="offer-item">
                    <div class="offer-label">Candidate</div>
                    <div class="offer-value">{{ candidate.name }}</div>
                  </div>
                  <div class="offer-item">
                    <div class="offer-label">Position</div>
                    <div class="offer-value">{{ candidate.position }}</div>
                  </div>
                  <div class="offer-item">
                    <div class="offer-label">Issued By</div>
                    <div class="offer-value">{{ candidate.offer_issued_by }}</div>
                  </div>
                  <div class="offer-item">
                    <div class="offer-label">Status</div>
                    <div class="offer-value">
                      {% if candidate.contract_signed %}
                        <span class="status-badge success">✓ Contract Signed</span>
                      {% elif candidate.offer_accepted %}
                        <span class="status-badge warning">📋 Offer Accepted</span>
                      {% else %}
                        <span class="status-badge pending">⏳ Pending Response</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
                
                <div style="background: #f7fafc; padding: 12px; border-radius: 6px; margin-top: 12px; border: 1px solid #e2e8f0; max-height: 150px; overflow-y: auto;">
                  <h4 style="color: #2d3748; margin-bottom: 8px; font-size: 0.9rem;">Offer Letter Content:</h4>
                  <pre style="white-space: pre-wrap; font-family: inherit; font-size: 0.8rem; line-height: 1.5; color: #2d3748; margin: 0;">{{ candidate.offer_letter_details }}</pre>
                </div>
              </div>
              {% else %}
              <div class="card">
                <p style="text-align: center; color: #6b7280; font-size: 0.9rem;">Offer letter details will appear here</p>
              </div>
              {% endif %}
            </div>
          </div>
          
          <!-- Collapsible Onboarding Details -->
          <div id="onboarding-details" class="collapsible-content">
            <div class="step-details">
              <div class="card">
                <h3 class="card-title">🚀 Onboarding Progress</h3>
                <form action="/update_onboarding" method="post">
                  <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
                  <div style="background: #f7fafc; border-radius: 6px; overflow: hidden; border: 1px solid #e2e8f0;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem;">
                      <thead>
                        <tr style="background: #e2e8f0;">
                          <th style="padding: 8px; text-align: left; font-weight: 600; color: #2d3748;">Step</th>
                          <th style="padding: 8px; text-align: center; font-weight: 600; color: #2d3748;">Status</th>
                          <th style="padding: 8px; text-align: center; font-weight: 600; color: #2d3748;">Done</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% set main_steps = ['Joining Formalities', 'HR Introduction', 'Document Verification', 'System Allocation'] %}
                        {% for step in main_steps %}
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                          <td style="padding: 8px; color: #2d3748;">{{ step }}</td>
                          <td style="padding: 8px; text-align: center;">
                            <span style="padding: 3px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: 500; border: 1px solid;
                              {% if candidate.onboarding and candidate.onboarding.get(step) == 'Completed' %}
                                background: #f0fff4; color: #22543d; border-color: #c6f6d5;
                              {% else %}
                                background: #fffbeb; color: #744210; border-color: #fbd38d;
                              {% endif %}">
                              {{ candidate.onboarding.get(step, 'Pending') if candidate.onboarding else 'Pending' }}
                            </span>
                          </td>
                          <td style="padding: 8px; text-align: center;">
                            <input type="checkbox" name="{{ step.replace(' ', '_').lower() }}" value="1" 
                                   {% if candidate.onboarding and candidate.onboarding.get(step) == 'Completed' %}checked{% endif %}
                                   style="width: 16px; height: 16px; accent-color: #48bb78;">
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <button type="submit" class="btn btn-primary" style="margin-top: 10px; padding: 6px 12px; font-size: 0.8rem;">💾 Update Onboarding</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resume and Video Preview -->
      <div class="card">
        <h2 class="card-title">📄 Documents & Media</h2>
        
        {% if candidate.cv_path %}
        <div style="margin-bottom: 20px;">
          <h4 style="color: #374151; margin-bottom: 10px;">Resume</h4>
          {% if candidate.cv_path.lower().endswith('.pdf') %}
            <div class="file-preview">
              <embed src="{{ url_for('uploaded_file', filename=candidate.cv_path) }}" type="application/pdf" width="100%" height="400px" />
            </div>
            <div style="margin-top: 10px;">
              <a href="{{ url_for('uploaded_file', filename=candidate.cv_path) }}" target="_blank" class="btn btn-primary" style="display: inline-block; width: auto;">
                📥 Download Resume
              </a>
            </div>
          {% else %}
            <a href="{{ url_for('uploaded_file', filename=candidate.cv_path) }}" target="_blank" class="btn btn-primary" style="display: inline-block; width: auto;">
              📥 Download Resume
            </a>
          {% endif %}
        </div>
        {% endif %}
        
        {% if candidate.interview_video %}
        <div>
          <h4 style="color: #374151; margin-bottom: 10px;">Interview Video</h4>
          <div class="file-preview">
            <video controls width="100%" style="border-radius: 8px;">
              <source src="{{ url_for('uploaded_file', filename=candidate.interview_video) }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
          <div style="margin-top: 10px;">
            <a href="{{ url_for('uploaded_file', filename=candidate.interview_video) }}" target="_blank" class="btn btn-primary" style="display: inline-block; width: auto;">
              📥 Download Video
            </a>
          </div>
        </div>
        {% endif %}
        
        {% if not candidate.cv_path and not candidate.interview_video %}
        <div style="text-align: center; padding: 40px; color: #6b7280;">
          <p>📂 No documents or media files uploaded yet.</p>
        </div>
        {% endif %}
      </div>
    </div>
    
    <!-- Action Sidebar -->
    <div class="action-panel">
      
      <!-- Interview Analysis Section -->
      {% if candidate.status == 'Interview Scheduled' and role in ['HR', 'HR Manager', 'Manager', 'Department Manager (MOE)', 'Department Manager (MOP)', 'Operation Manager', 'CEO', 'Discipline Manager'] %}
      <div class="action-card">
        <h3 style="color: #374151; margin-bottom: 15px;">🎥 Interview Analysis</h3>
        <form id="interviewForm" action="/interview_analysis" method="post" enctype="multipart/form-data">
          <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
          <div class="form-group">
            <label class="form-label" for="video_file">Upload Interview Video</label>
            <input type="file" id="video_file" name="video_file" accept="video/*" required class="form-control">
          </div>
          <button type="submit" class="btn btn-primary">📊 Analyze Interview</button>
        </form>
        <div id="result" style="margin-top: 15px;"></div>
      </div>
      {% endif %}

      <!-- Schedule Interview Section -->
      {% if schedule_interview or (candidate.status == 'Shortlisted' and role in ['HR', 'HR Manager', 'Manager']) %}
      <div class="action-card">
        <h3 style="color: #374151; margin-bottom: 15px;">📅 Schedule Interview</h3>
        <form action="/schedule_interview" method="post">
          <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
          <input type="hidden" name="interviewer" value="{{ request.cookies.get('username', '') }}">
          <div class="form-group">
            <label class="form-label" for="interview_date">Interview Date</label>
            <input type="date" id="interview_date" name="interview_date" required class="form-control">
          </div>
          <div class="form-group">
            <label class="form-label" for="interview_time">Interview Time</label>
            <input type="time" id="interview_time" name="interview_time" required class="form-control">
          </div>
          <button type="submit" class="btn btn-primary">📅 Schedule Interview</button>
        </form>
      </div>
      {% endif %}

      <!-- Send for Approval Section -->
      {% if (candidate.status == 'Interview Analyzed' or candidate.status == 'Interviewed') and role in ['HR', 'HR Manager'] %}
      <div class="action-card" style="background: #f0fdf4; border: 1px solid #10b981;">
        <h3 style="color: #065f46; margin-bottom: 15px;">✅ Send for Approval</h3>
        <p style="color: #047857; margin-bottom: 15px; font-size: 0.9rem;">
          Interview completed! Ready to send for management approval.
        </p>
        <form action="/send_for_approval" method="post">
          <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
          <input type="hidden" name="interviewer" value="{{ request.cookies.get('username', '') }}">
          <div class="form-group">
            <label class="form-label" for="approval_message">Approval Request Message</label>
            <textarea id="approval_message" name="approval_message" rows="4" 
                      placeholder="Provide details about the candidate's interview performance and recommendation..."
                      class="form-control" required></textarea>
          </div>
          <button type="submit" class="btn btn-success">🚀 Send for Approval</button>
        </form>
      </div>
      {% endif %}

      <!-- Approval Action Section -->
      {% if candidate.status == 'Pending Approval' and role in ['Discipline Manager', 'Department Manager (MOE)', 'Department Manager (MOP)', 'Operation Manager', 'CEO'] %}
      <div class="action-card" style="background: #fffbeb; border: 1px solid #f59e0b;">
        <h3 style="color: #92400e; margin-bottom: 15px;">🔍 Pending Your Approval</h3>
        <div style="background: #fef3c7; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
          <p style="margin: 0; font-size: 0.9rem; color: #92400e;">
            <strong>{{ candidate.name }}</strong> - {{ candidate.position }}<br>
            Your Role: <strong>{{ role }}</strong>
          </p>
        </div>
        
        {% if candidate.approval_request_message %}
        <div style="background: #f3f4f6; padding: 12px; border-left: 4px solid #3b82f6; margin-bottom: 15px;">
          <p style="margin: 0; font-size: 0.85rem; color: #374151;">
            <strong>Request Message:</strong><br>
            {{ candidate.approval_request_message }}
          </p>
        </div>
        {% endif %}

        <form action="/approve_candidate" method="post">
          <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
          <div class="form-group">
            <label class="form-label" for="approval_comment">Your Decision & Comment</label>
            <textarea id="approval_comment" name="approval_comment" rows="4" 
                      placeholder="Provide your assessment and feedback..."
                      class="form-control" required></textarea>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button type="submit" name="action" value="approve" class="btn btn-success">✅ Approve</button>
            <button type="submit" name="action" value="reject" class="btn btn-danger">❌ Reject</button>
          </div>
          <button type="submit" name="action" value="hold" class="btn btn-warning" style="margin-top: 10px;">⏸️ Put on Hold</button>
        </form>
      </div>
      {% endif %}

      <!-- HR Final Action - Mark as Selected -->
      {% if candidate.status == 'Approved' and role in ['HR', 'HR Manager'] %}
      <div class="action-card" style="background: #f0fdf4; border: 1px solid #10b981;">
        <h3 style="color: #065f46; margin-bottom: 15px;">🎉 Final Approval Complete!</h3>
        <p style="color: #047857; margin-bottom: 15px; font-size: 0.9rem;">
          <strong>{{ candidate.name }}</strong> has been approved by management!
        </p>
        
        {% if candidate.final_approved_by %}
        <div style="background: #f3f4f6; padding: 12px; border-left: 4px solid #10b981; margin-bottom: 15px;">
          <p style="margin: 0; font-size: 0.85rem; color: #374151;">
            <strong>Approved by:</strong> {{ candidate.final_approved_by }}<br>
            {% if candidate.final_approved_at %}Date: {{ candidate.final_approved_at[:10] }}{% endif %}
          </p>
        </div>
        {% endif %}

        <form action="/update_candidate_status" method="post">
          <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
          <input type="hidden" name="new_status" value="Selected">
          <button type="submit" class="btn btn-primary">📋 Mark as Selected</button>
        </form>
      </div>
      {% endif %}

      <!-- Offer Letter Section -->
      {% if candidate.status == 'Selected' and role == 'Operation Manager' %}
      <div class="action-card" style="background: #eff6ff; border: 1px solid #3b82f6;">
        <h3 style="color: #1e40af; margin-bottom: 15px;">📝 Issue Offer Letter</h3>
        <form action="/issue_offer_letter" method="post">
          <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
          <div class="form-group">
            <label class="form-label" for="offer_details">Offer Letter Content</label>
            <textarea id="offer_details" name="offer_details" rows="8" required class="form-control"
                      placeholder="Enter offer letter details...">Dear {{ candidate.name }},

We are pleased to offer you the position of {{ candidate.position }} at our company.

Position: {{ candidate.position }}
Start Date: [Enter Start Date]
Salary: [Enter Salary Details]
Reporting Manager: {{ request.cookies.get('username', '') }}

Best regards,
{{ request.cookies.get('username', '') }}
Operation Manager</textarea>
          </div>
          <button type="submit" class="btn btn-primary">📧 Issue Offer Letter</button>
        </form>
      </div>
      {% endif %}

      <!-- Status Update Section -->
      <div class="action-card">
        <h3 style="color: #374151; margin-bottom: 15px;">⚙️ Update Status</h3>
        
        <!-- API Notice -->
        <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 12px; margin-bottom: 15px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
            <span style="color: #92400e; font-size: 1.1rem;">ℹ️</span>
            <strong style="color: #92400e; font-size: 0.9rem;">API Integration Notice</strong>
          </div>
          <p style="color: #78350f; font-size: 0.8rem; margin: 0; line-height: 1.4;">
            As of now, there is no API integration for automatic status updates. When the APIs are provided, 
            status updates will be done automatically based on workflow triggers and candidate actions.
          </p>
        </div>
        
        <form action="/update_candidate_status" method="post">
          <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
          <div class="form-group">
            <label class="form-label" for="new_status">Change Status</label>
            <select id="new_status" name="new_status" required class="form-control">
              <option value="Selected" {% if candidate.status == 'Selected' %}selected{% endif %}>Selected</option>
              <option value="Shortlisted" {% if candidate.status == 'Shortlisted' %}selected{% endif %}>Shortlisted</option>
              <option value="Interview Scheduled" {% if candidate.status == 'Interview Scheduled' %}selected{% endif %}>Interview Scheduled</option>
              <option value="Interviewed" {% if candidate.status == 'Interviewed' %}selected{% endif %}>Interviewed</option>
              <option value="Hired" {% if candidate.status == 'Hired' %}selected{% endif %}>Hired</option>
              <option value="Resigned" {% if candidate.status == 'Resigned' %}selected{% endif %}>Resigned</option>
              <option value="Fired" {% if candidate.status == 'Fired' %}selected{% endif %}>Fired</option>
              <option value="Rejected" {% if candidate.status == 'Rejected' %}selected{% endif %}>Rejected</option>
              <option value="On Hold" {% if candidate.status == 'On Hold' %}selected{% endif %}>On Hold</option>
              <option value="Onboarding" {% if candidate.status == 'Onboarding' %}selected{% endif %}>Onboarding</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">💾 Update Status</button>
        </form>
      </div>

      <!-- Employee Management for Hired Candidates -->
      {% if candidate.status == 'Hired' %}
      <div class="action-card">
        <h3 style="color: #2d3748; margin-bottom: 15px;">👤 Employee Management</h3>
        <a href="{{ url_for('probation_assessment', candidate_id=candidate.id) }}" class="btn btn-primary">
          📊 Probation Assessment
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</div>



<!-- JavaScript for Enhanced Functionality -->
<script>
// Interview form submission
document.getElementById('interviewForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    const resultDiv = document.getElementById('result');
    
    resultDiv.innerHTML = '<div style="color: #3b82f6; font-weight: 600;">📊 Uploading and analyzing... Please wait.</div>';
    
    try {
        const response = await fetch('/interview_analysis', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            location.reload();
        } else {
            resultDiv.innerHTML = `<div style="color: #ef4444; font-weight: 600;">❌ Error: ${data.message}</div>`;
        }
    } catch (err) {
        resultDiv.innerHTML = `<div style="color: #ef4444; font-weight: 600;">❌ Request failed: ${err}</div>`;
    }
});

// Enhanced form interactions
document.addEventListener('DOMContentLoaded', function() {
    // Auto-resize textareas
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    });
    
    // Timeline collapsible functionality
    const triggers = document.querySelectorAll('.collapsible-trigger');
    console.log('Found triggers:', triggers.length);
    
    triggers.forEach(trigger => {
        trigger.addEventListener('click', function() {
            console.log('Trigger clicked:', this);
            const targetId = this.getAttribute('data-target');
            const targetElement = document.getElementById(targetId);
            const expandIcon = this.querySelector('.expand-icon');
            
            console.log('Target ID:', targetId, 'Target Element:', targetElement);
            
            if (targetElement) {
                // Remove active class from all timeline steps first
                document.querySelectorAll('.timeline-step').forEach(step => {
                    step.classList.remove('active');
                });
                
                // Hide all other collapsible contents first
                document.querySelectorAll('.collapsible-content').forEach(content => {
                    if (content !== targetElement) {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    }
                });
                document.querySelectorAll('.expand-icon').forEach(icon => {
                    if (icon !== expandIcon) {
                        icon.innerHTML = '▼';
                    }
                });
                
                // Toggle the clicked content
                if (targetElement.classList.contains('active')) {
                    targetElement.classList.remove('active');
                    targetElement.style.display = 'none';
                    this.classList.remove('active'); // Remove connection line
                    if (expandIcon) expandIcon.innerHTML = '▼';
                    console.log('Hiding content');
                } else {
                    targetElement.classList.add('active');
                    targetElement.style.display = 'block';
                    this.classList.add('active'); // Add connection line
                    if (expandIcon) expandIcon.innerHTML = '▲';
                    console.log('Showing content');
                    
                    // Smooth scroll to the details
                    setTimeout(() => {
                        targetElement.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest' 
                        });
                    }, 100);
                }
            } else {
                console.log('Target element not found');
            }
        });
    });
    
    // Initially hide all collapsible content
    document.querySelectorAll('.collapsible-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
    });
    
    // Form validation enhancements
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = '#ef4444';
                    isValid = false;
                } else {
                    field.style.borderColor = '#d1d5db';
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                alert('Please fill in all required fields.');
            }
        });
    });
});
</script>

{% endblock %}
